<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dünya Fetih Stratejisi</title>
    <link rel="stylesheet" href="style.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <div class="background-pattern"></div>

    <!-- Ses Göstergesi -->
    <div class="sound-indicator" id="sound-indicator" onclick="game?.toggleSound()">
        Ses: Açık
    </div>

    <!-- Başlangıç Ekranı -->
    <div class="start-screen" id="start-screen">
        <div class="start-content">
            <h1 class="start-title">Dünya Fetih Stratejisi</h1>
            <p class="start-subtitle">Dünyayı Fethet, Tarihi Yaz</p>
            
            <!-- Multiplayer Menü -->
            <div class="multiplayer-menu" id="multiplayer-menu">
                <h2>Oyun Modu Seç</h2>
                <div style="display: flex; gap: 20px; justify-content: center; margin-bottom: 30px;">
                    <button class="mode-btn" onclick="showSinglePlayer()">
                        <svg width="40" height="40" viewBox="0 0 40 40" fill="white">
                            <circle cx="20" cy="15" r="8"/>
                            <path d="M8 35 C8 28 12 25 20 25 C28 25 32 28 32 35"/>
                        </svg>
                        <div>Tek Oyunculu</div>
                    </button>
                    <button class="mode-btn" onclick="showMultiplayerOptions()">
                        <svg width="40" height="40" viewBox="0 0 40 40" fill="white">
                            <circle cx="15" cy="12" r="6"/>
                            <circle cx="25" cy="12" r="6"/>
                            <path d="M5 30 C5 24 8 22 15 22 C22 22 25 24 25 30"/>
                            <path d="M15 30 C15 24 18 22 25 22 C32 22 35 24 35 30"/>
                        </svg>
                        <div>Çok Oyunculu</div>
                    </button>
                </div>
            </div>

            <!-- Multiplayer Seçenekleri -->
            <div class="multiplayer-options" id="multiplayer-options" style="display: none;">
                <h2>Çok Oyunculu</h2>
                <div style="margin-bottom: 20px;">
                    <input type="text" id="player-name" placeholder="İsminizi girin" 
                        style="width: 100%; padding: 15px; font-size: 16px; border: 2px solid #d4af37; 
                        background: rgba(20, 15, 10, 0.8); color: white; margin-bottom: 15px;">
                </div>
                <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 20px;">
                    <button class="mode-btn" onclick="createMultiplayerRoom()">
                        <svg width="30" height="30" viewBox="0 0 30 30" fill="white">
                            <path d="M15 5 L15 25 M5 15 L25 15"/>
                        </svg>
                        <div>Oda Oluştur</div>
                    </button>
                    <button class="mode-btn" onclick="showJoinRoom()">
                        <svg width="30" height="30" viewBox="0 0 30 30" fill="white">
                            <path d="M5 15 L20 15 M15 10 L20 15 L15 20"/>
                        </svg>
                        <div>Odaya Katıl</div>
                    </button>
                </div>
                <div id="join-room-input" style="display: none; margin-bottom: 15px;">
                    <input type="text" id="room-code" placeholder="Oda Kodu" 
                        style="width: 100%; padding: 15px; font-size: 16px; border: 2px solid #d4af37; 
                        background: rgba(20, 15, 10, 0.8); color: white; margin-bottom: 10px;">
                    <button class="start-btn" onclick="joinMultiplayerRoom()">Katıl</button>
                </div>
                <button class="start-btn" onclick="showMultiplayerMenu()" 
                    style="background: #666; margin-top: 10px;">Geri</button>
            </div>
            
            <div class="faction-selection" id="faction-selection" style="display: none;">
                <h2>İmparatorluğunu Seç</h2>
                <div class="faction-cards">
                    <div class="faction-card muslim" onclick="selectFaction('MUSLIM')">
                        <div class="faction-icon">
                            <svg width="40" height="40" viewBox="0 0 40 40" fill="white">
                                <path d="M20 5 L25 15 L35 15 L27 22 L30 32 L20 25 L10 32 L13 22 L5 15 L15 15 Z"/>
                            </svg>
                        </div>
                        <div class="faction-name">Müslüman İmparatorluğu</div>
                        <div class="faction-desc">Güçlü ve stratejik. Doğu'nun hakimi.</div>
                    </div>
                    
                    <div class="faction-card christian" onclick="selectFaction('CHRISTIAN')">
                        <div class="faction-icon">
                            <svg width="40" height="40" viewBox="0 0 40 40" fill="white">
                                <rect x="17" y="5" width="6" height="30"/>
                                <rect x="10" y="15" width="20" height="6"/>
                            </svg>
                        </div>
                        <div class="faction-name">Hristiyan Krallığı</div>
                        <div class="faction-desc">Cesur ve kararlı. Batı'nın gücü.</div>
                    </div>
                    
                    <div class="faction-card jewish" onclick="selectFaction('JEWISH')">
                        <div class="faction-icon">
                            <svg width="40" height="40" viewBox="0 0 40 40" fill="white">
                                <polygon points="20,8 26,18 20,22 14,18"/>
                                <polygon points="20,32 26,22 20,18 14,22"/>
                            </svg>
                        </div>
                        <div class="faction-name">Yahudi Devleti</div>
                        <div class="faction-desc">Zeki ve dirençli. Kadim bilgelik.</div>
                    </div>
                </div>
                
                <button class="start-btn" id="start-btn" onclick="startGame()">
                    Oyuna Başla
                </button>
            </div>
        </div>
    </div>

    <!-- Ana Oyun -->
    <div class="container">
        <header class="game-header">
            <h1 class="game-title">Dünya Fetih Stratejisi</h1>
            <p class="game-subtitle">Strateji, Güç ve Zafer</p>
        </header>

        <div class="game-layout">
            <!-- Sol Panel - İstatistikler -->
            <div class="panel">
                <h3 class="panel-title">İmparatorluk İstatistikleri</h3>
                <div id="faction-stats"></div>
            </div>

            <!-- Orta Panel - Harita -->
            <div class="panel">
                <div class="turn-indicator">
                    <div class="turn-text" id="current-turn">Oyuncu Sırası</div>
                    <div class="turn-number">Tur: <span id="turn-count">1</span></div>
                    <div class="controls">
                        <button class="control-btn" onclick="game?.skipTurn()">Sırayı Geç</button>
                        <button class="control-btn primary" onclick="game?.restart()">Yeni Oyun</button>
                    </div>
                </div>
                
                <div class="world-map-container" id="map-container">
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="game?.zoomIn()">+</button>
                        <div class="zoom-level" id="zoom-level">100%</div>
                        <button class="zoom-btn" onclick="game?.zoomOut()">−</button>
                        <button class="zoom-btn" onclick="game?.resetZoom()" title="Sıfırla">⟲</button>
                    </div>
                    <div class="world-map" id="world-map"></div>
                </div>
            </div>

            <!-- Sağ Panel - Aksiyonlar ve Günlük -->
            <div class="panel">
                <h3 class="panel-title">Aksiyonlar</h3>
                <div class="action-buttons">
                    <button class="action-btn action-btn-cancel" onclick="game?.clearSelection()">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                        Seçimi İptal Et
                    </button>
                    
                    <button class="action-btn" id="btn-attack" disabled onclick="game?.attackTarget()">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                        </svg>
                        Saldır
                    </button>
                    
                    <button class="action-btn" id="btn-transfer" disabled onclick="game?.transferTroops()">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 17v2H2v-2s0-4 7-4 7 4 7 4m-3.5-9.5A3.5 3.5 0 1 0 9 11a3.5 3.5 0 0 0 3.5-3.5m3.44 5.5A5.32 5.32 0 0 1 18 17v2h4v-2s0-3.63-6.06-4M15 4a3.39 3.39 0 0 0-1.93.59 5 5 0 0 1 0 5.82A3.39 3.39 0 0 0 15 11a3.5 3.5 0 0 0 0-7z"/>
                        </svg>
                        Asker Transfer
                    </button>
                    
                    <button class="action-btn action-btn-build" id="btn-farm" disabled onclick="game?.buildFarm()">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                        Farm İnşa Et (50)
                    </button>
                    
                    <button class="action-btn action-btn-build" id="btn-barracks" disabled onclick="game?.buildBarracks()">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
                            <circle cx="12" cy="12" r="2"/>
                        </svg>
                        Kışla İnşa Et (100)
                    </button>
                    
                    <button class="action-btn" id="btn-fortify" disabled onclick="game?.fortifyCity()">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
                            <path d="M12 8l-3 3h2v4h2v-4h2z"/>
                        </svg>
                        Tahkim Et
                    </button>
                </div>

                <h3 class="panel-title" style="margin-top: 30px;">Savaş Günlüğü</h3>
                <div class="battle-log" id="log-content"></div>
            </div>
        </div>
    </div>

    <!-- Transfer Modal -->
    <div class="transfer-modal" id="transfer-modal">
        <div class="transfer-content">
            <h3>Asker Transfer</h3>
            <div class="transfer-info">
                <div><strong>Kaynak:</strong> <span id="transfer-from"></span></div>
                <div><strong>Hedef:</strong> <span id="transfer-to"></span></div>
                <div><strong>Mevcut Asker:</strong> <span id="transfer-available"></span></div>
            </div>
            
            <div class="transfer-slider">
                <label>Transfer Edilecek Asker Sayısı:</label>
                <input type="range" id="transfer-amount" min="1" max="10" value="5" 
                       oninput="game?.updateTransferValue()">
                <div class="transfer-value" id="transfer-value">5</div>
            </div>
            
            <div class="transfer-buttons">
                <button class="btn btn-primary" onclick="game?.confirmTransfer()">Transfer Et</button>
                <button class="btn btn-secondary" onclick="game?.closeTransferModal()">İptal</button>
            </div>
        </div>
    </div>

    <!-- Oyun Sonu -->
    <div class="game-over" id="game-over">
        <div class="game-over-content">
            <h2>Oyun Bitti!</h2>
            <div class="winner-icon">
                <svg width="60" height="60" viewBox="0 0 60 60" fill="var(--accent-gold)">
                    <path d="M30 5 L35 20 L50 20 L38 30 L43 45 L30 35 L17 45 L22 30 L10 20 L25 20 Z"/>
                </svg>
            </div>
            <div class="winner-text" id="winner-text"></div>
            <button class="btn btn-primary" onclick="game?.restart()">Yeniden Başla</button>
        </div>
    </div>

    <script src="multiplayer.js"></script>
    <script src="game.js"></script>
    <script>
        // Multiplayer menü fonksiyonları
        function showSinglePlayer() {
            document.getElementById('multiplayer-menu').style.display = 'none';
            document.getElementById('faction-selection').style.display = 'block';
        }

        function showMultiplayerOptions() {
            document.getElementById('multiplayer-menu').style.display = 'none';
            document.getElementById('multiplayer-options').style.display = 'block';
        }

        function showMultiplayerMenu() {
            document.getElementById('multiplayer-options').style.display = 'none';
            document.getElementById('join-room-input').style.display = 'none';
            document.getElementById('multiplayer-menu').style.display = 'block';
        }

        function showJoinRoom() {
            document.getElementById('join-room-input').style.display = 'block';
        }

        function createMultiplayerRoom() {
            const playerName = document.getElementById('player-name').value.trim();
            if (!playerName) {
                alert('Lütfen isminizi girin');
                return;
            }
            multiplayerManager.createRoom(playerName);
        }

        function joinMultiplayerRoom() {
            const playerName = document.getElementById('player-name').value.trim();
            const roomCode = document.getElementById('room-code').value.trim().toUpperCase();
            
            if (!playerName) {
                alert('Lütfen isminizi girin');
                return;
            }
            if (!roomCode) {
                alert('Lütfen oda kodunu girin');
                return;
            }
            
            multiplayerManager.joinRoom(roomCode, playerName);
        }
    </script>
</body>
</html>